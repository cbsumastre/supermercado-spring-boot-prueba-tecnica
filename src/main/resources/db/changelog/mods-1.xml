<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.27.xsd">

  <changeSet id="1" author="cbsumastre">
    <createTable tableName="SUCURSAL">
      <column name="id" type="IDENTITY">
        <constraints primaryKey="true"/>
      </column>
      <column name="nombre" type="VARCHAR(200)">
        <constraints nullable="false"/>
      </column>
      <column name="direccion" type="VARCHAR(200)">
        <constraints nullable="false"/>
      </column>
    </createTable>

    <sqlFile path="data/insert-sucursales.sql" relativeToChangelogFile="true" splitStatements="true" stripComments="true" encoding="UTF-8"/>


  </changeSet>

  <changeSet id="2" author="cbsumastre">
    <createTable tableName="CATEGORIA">
      <column name="id" type="VARCHAR(200)">
        <constraints primaryKey="true"/>
      </column>
      <column name="descripcion" type="VARCHAR(200)">
        <constraints nullable="false"/>
      </column>
    </createTable>

    <sqlFile path="db/changelog/data/insert-categorias-producto.sql" relativeToChangelogFile="false" splitStatements="true" stripComments="true" encoding="UTF-8"/>

  </changeSet>


  <changeSet id="3" author="cbsumastre">
    <createTable tableName="PRODUCTO">
      <column name="id" type="IDENTITY">
        <constraints primaryKey="true"/>
      </column>
      <column name="nombre" type="VARCHAR(200)">
        <constraints nullable="false"/>
      </column>
      <column name="categoria_id" type="VARCHAR(200)">
        <constraints nullable="false"/>
      </column>
      <column name="stock" type="INT" defaultValueNumeric="0">
        <constraints nullable="false"/>
      </column>
      <column name="precio" type="NUMERIC(10,2)">
        <constraints nullable="false"/>
      </column>
    </createTable>

    <addForeignKeyConstraint baseTableName="producto" baseColumnNames="categoria_id" constraintName="fk_producto_categoria" referencedTableName="categoria" referencedColumnNames="id" />

    <sqlFile path="data/insert-productos.sql" relativeToChangelogFile="true" splitStatements="true" stripComments="true" encoding="UTF-8" />

  </changeSet>

  <changeSet id="4" author="cbsumastre">
    <createTable tableName="VENTA">
      <column name="id" type="BIGINT" autoIncrement="true">
        <constraints primaryKey="true"/>
      </column>
      <column name="fecha" type="DATETIME">
        <constraints nullable="false"/>
      </column>
      <column name="estado" type="VARCHAR(50)">
        <constraints nullable="false"/>
      </column>

      <column name="sucursal_id" type="BIGINT">
        <constraints nullable="false"/>
      </column>
    </createTable>

    <addForeignKeyConstraint baseTableName="VENTA" baseColumnNames="sucursal_id" constraintName="fk_venta_sucursal" referencedTableName="SUCURSAL" referencedColumnNames="id" onDelete="RESTRICT" />

    <sqlFile path="data/insert-ventas.sql" relativeToChangelogFile="true" splitStatements="true" stripComments="true" encoding="UTF-8"/>

  </changeSet>

  <changeSet id="5" author="cbsumastre">
    <createTable tableName="DETALLE_VENTA">
      <column name="id" type="BIGINT" autoIncrement="true">
        <constraints primaryKey="true"/>
      </column>
      <column name="venta_id" type="BIGINT">
        <constraints nullable="false"/>
      </column>
      <column name="producto_id" type="BIGINT">
        <constraints nullable="false"/>
      </column>
      <column name="cantidad" type="INT">
        <constraints nullable="false"/>
      </column>
      <column name="precio" type="NUMERIC(10,2)">
        <constraints nullable="false"/>
      </column>
    </createTable>

    <addForeignKeyConstraint baseTableName="DETALLE_VENTA" baseColumnNames="venta_id" constraintName="fk_venta_detalle_venta" referencedTableName="VENTA" referencedColumnNames="id" onDelete="RESTRICT"/>
    <addForeignKeyConstraint baseTableName="DETALLE_VENTA" baseColumnNames="producto_id" constraintName="fk_venta_detalle_producto" referencedTableName="PRODUCTO" referencedColumnNames="id" onDelete="RESTRICT"/>

    <sqlFile path="data/insert-detalle-ventas.sql" relativeToChangelogFile="true" splitStatements="true" stripComments="true" encoding="UTF-8"/>

  </changeSet>


</databaseChangeLog>